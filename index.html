<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Operator Machine Performance Report</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.31.1.min.js"></script>
  <style>
    body { background: #f8f9fa; padding: 20px; }
    .card { margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .section-title { font-weight: bold; font-size: 1.2rem; color: #333; margin-bottom: 10px; }
    table th { background-color: #007bff; color: white; text-align: center; }
    table td { text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center mb-4">Operator Machine Performance Report</h2>

    <!-- Date Selector -->
    <div class="card p-3 mb-4">
      <label for="reportDate" class="form-label">Select Date:</label>
      <input type="date" id="reportDate" class="form-control mb-2">
      <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
    </div>

    <!-- Report Sections -->
    <div id="reportContent">
      <!-- Sections dynamically inserted -->
    </div>
  </div>

  <script>
    const API_URL = "https://example.com/api/data"; // Replace with real API

    async function generateReport() {
      const date = document.getElementById("reportDate").value;
      if (!date) return alert("Please select a date first.");

      try {
        const response = await axios.get(`${API_URL}?date=${date}`);
        const data = response.data; // API returns telemetry for that day

        buildReport(data);
      } catch (err) {
        console.error(err);
        alert("Error fetching data from API.");
      }
    }

    function buildReport(data) {
      const container = document.getElementById("reportContent");
      container.innerHTML = "";

      // Section 1: Operator Overview
      container.innerHTML += `
        <div class="card p-3">
          <div class="section-title">1. Operator Overview</div>
          <p><strong>Operator Name:</strong> ${data.operator || 'N/A'}</p>
          <p><strong>Machine Assigned:</strong> ${data.machine || 'N/A'}</p>
          <p><strong>Shift / Line:</strong> ${data.shift || 'N/A'}</p>
        </div>
      `;

      // Section 2: Production Details (SKU-wise)
      let skuRows = data.production.map(sku => `
        <tr>
          <td>${sku.SKU}</td>
          <td>${sku.productionUnits}</td>
          <td>${sku.runtime}</td>
          <td>${sku.downtime}</td>
        </tr>
      `).join('');

      container.innerHTML += `
        <div class="card p-3">
          <div class="section-title">2. Production Details (SKU-wise)</div>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>SKU Name</th>
                <th>Production (Units)</th>
                <th>Runtime (hrs)</th>
                <th>Downtime (hrs)</th>
              </tr>
            </thead>
            <tbody>${skuRows}</tbody>
          </table>
        </div>
      `;

      // Section 3: OEE and Performance Chart (placeholder)
      container.innerHTML += `
        <div class="card p-3">
          <div class="section-title">3. Machine Performance Summary</div>
          <div id="oeeChart" style="height:300px;"></div>
        </div>
      `;
      renderOEEChart(data.oee);
    }

    function renderOEEChart(oee) {
      const trace = {
        x: ['OEE', 'Performance', 'Availability', 'Quality'],
        y: [oee.oee, oee.performance, oee.availability, oee.quality],
        type: 'bar',
        marker: { color: ['#ff9800','#2196f3','#4caf50','#f44336'] }
      };
      Plotly.newPlot('oeeChart', [trace], { margin: { t: 20 } });
    }
  </script>
</body>
</html>
